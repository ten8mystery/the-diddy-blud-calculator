<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Diddy Blud Calculator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for sound effects and sampler -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Set the custom font */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrolling if the GIF is larger than viewport */
        }
        
        /* Custom background styling for the GIF */
        .gif-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://media.tenor.com/yOKTxh5m2lIAAAAM/tesla-and-einstein-luma-ai.gif');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            z-index: -2; /* Place behind the content */
        }

        /* Dark overlay for readability - reduced opacity from 0.7 to 0.5 */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); 
            z-index: -1;
        }

        .calc-button {
            @apply p-4 rounded-lg text-2xl font-bold transition duration-150 ease-in-out shadow-lg transform hover:scale-105;
            min-width: 60px; /* Ensure buttons are not too small */
            height: 60px;
        }
        
        /* Responsive sizing for the main calculator card */
        @media (max-width: 640px) {
            .calculator-card {
                width: 95%;
                max-width: none;
            }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">

    <!-- Background GIF container -->
    <div class="gif-background" role="img" aria-label="Animated GIF featuring figures resembling Nikola Tesla and Albert Einstein"></div>

    <!-- Dark Overlay for Readability -->
    <div class="overlay"></div>

    <!-- Sahur GIF Popup (Initially Hidden) -->
    <!-- This container pops up when '67' is the result. -->
    <div id="sahur-gif-container" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50 hidden">
        <div class="p-4 bg-gray-900 rounded-2xl shadow-2xl transform transition duration-300 scale-100 border-4 border-yellow-500">
            <!-- UPDATED CAPTION TEXT -->
            <h2 class="text-3xl font-extrabold text-white text-center mb-2">676767676767</h2>
            <!-- !!! REPLACE THE SRC URL BELOW WITH YOUR ACTUAL SAHUR GIF URL !!! -->
            <img src="https://media.tenor.com/QLXzTViuHXEAAAAM/tung-tung-tung-tung-sahur-gif.gif" 
                 alt="Celebration GIF" 
                 class="max-w-xs md:max-w-md rounded-lg">
        </div>
    </div>
    
    <!-- Calculator Card - Opacity reduced from 90% to 50% -->
    <div class="calculator-card p-6 bg-gray-900 bg-opacity-50 rounded-2xl shadow-2xl backdrop-blur-sm w-full max-w-sm mx-4">
        
        <h1 class="text-3xl font-extrabold text-blue-400 mb-4 text-center">The Diddy Blud Calculator</h1>

        <!-- Display -->
        <input id="display" type="text" readonly value="0" 
               class="w-full h-20 text-4xl text-right p-3 mb-6 rounded-xl bg-gray-800 text-green-400 font-mono shadow-inner border-2 border-green-500/50 focus:outline-none" 
               aria-label="Calculator display">
               
        <!-- Button Grid -->
        <div class="grid grid-cols-4 gap-3 text-white">
            
            <!-- Row 1 -->
            <button onclick="clearDisplay()" class="calc-button bg-red-600 hover:bg-red-700 col-span-2">C</button>
            <button onclick="appendOperator('/')" class="calc-button bg-gray-700 hover:bg-gray-600">/</button>
            <button onclick="appendOperator('*')" class="calc-button bg-gray-700 hover:bg-gray-600">*</button>

            <!-- Row 2 -->
            <button onclick="appendNumber(7)" class="calc-button bg-gray-800 hover:bg-gray-700">7</button>
            <button onclick="appendNumber(8)" class="calc-button bg-gray-800 hover:bg-gray-700">8</button>
            <button onclick="appendNumber(9)" class="calc-button bg-gray-800 hover:bg-gray-700">9</button>
            <button onclick="appendOperator('-')" class="calc-button bg-gray-700 hover:bg-gray-600">-</button>

            <!-- Row 3 -->
            <button onclick="appendNumber(4)" class="calc-button bg-gray-800 hover:bg-gray-700">4</button>
            <button onclick="appendNumber(5)" class="calc-button bg-gray-800 hover:bg-gray-700">5</button>
            <button onclick="appendNumber(6)" class="calc-button bg-gray-800 hover:bg-gray-700">6</button>
            <button onclick="appendOperator('+')" class="calc-button bg-gray-700 hover:bg-gray-600">+</button>

            <!-- Row 4 -->
            <button onclick="appendNumber(1)" class="calc-button bg-gray-800 hover:bg-gray-700">1</button>
            <button onclick="appendNumber(2)" class="calc-button bg-gray-800 hover:bg-gray-700">2</button>
            <button onclick="appendNumber(3)" class="calc-button bg-gray-800 hover:bg-gray-700">3</button>
            
            <!-- Equals Button - The Magic Button -->
            <button onclick="calculate()" class="calc-button bg-blue-600 hover:bg-blue-700 row-span-2 text-3xl">=</button>

            <!-- Row 5 (Part of) -->
            <button onclick="appendNumber(0)" class="calc-button bg-gray-800 hover:bg-gray-700 col-span-2">0</button>
            <button onclick="appendDecimal()" class="calc-button bg-gray-800 hover:bg-gray-700">.</button>
            
        </div>
    </div>

    <script>
        // --- Tone.js Setup for MP3 Loading ---
        let sampler;
        let einsteinPlayer; // New player for background loop
        let isVineBoomLoaded = false;
        let isEinsteinPlaying = false;
        
        function initializeAudioPlayers() {
            // 1. Sampler for the Vine Boom sound
            sampler = new Tone.Sampler({
                urls: { "C1": "vineboom.mp3" }, 
                onload: () => {
                    isVineBoomLoaded = true;
                    console.log("vineboom.mp3 loaded successfully.");
                },
                onerror: (e) => {
                    isVineBoomLoaded = false;
                    console.error("Error loading vineboom.mp3. Using silent fallback.", e);
                }
            }).toDestination();
            
            // 2. Player for the Einstein background loop
            einsteinPlayer = new Tone.Player({
                url: "einstien.mp3",
                loop: true, // This makes it play forever
                volume: -10, // Set volume lower for background music
                onload: () => {
                    console.log("einstien.mp3 loaded successfully.");
                    // If the user has already interacted, start playing immediately
                    if (Tone.context.state === 'running') {
                        startEinsteinLoop();
                    }
                },
                onerror: (e) => {
                    console.error("Error loading einstien.mp3.", e);
                }
            }).toDestination();
        }
        
        // Function to start the Einstein loop safely
        function startEinsteinLoop() {
             if (einsteinPlayer && einsteinPlayer.loaded && !isEinsteinPlaying) {
                einsteinPlayer.start();
                isEinsteinPlaying = true;
                // Remove the event listeners after the first successful start
                document.body.removeEventListener('click', startAudioContextAndLoop);
                document.body.removeEventListener('keydown', startAudioContextAndLoop);
            }
        }

        // Start loading the MP3s as soon as the DOM is ready
        document.addEventListener('DOMContentLoaded', initializeAudioPlayers);

        // Helper function to handle the necessary browser interaction to start audio
        function startAudioContextAndLoop() {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            startEinsteinLoop();
        }

        // Attach listeners to start audio context and the music loop on ANY user interaction
        document.body.addEventListener('click', startAudioContextAndLoop);
        document.body.addEventListener('keydown', startAudioContextAndLoop);


        function playBoomSound() {
            if (isVineBoomLoaded) {
                // Trigger the vine boom sound
                sampler.triggerAttackRelease("C1", "1s"); 
            } else {
                console.log("Vine boom sound is not ready yet.");
            }
        }
        // ----------------------------------------

        const display = document.getElementById('display');
        let currentInput = '';
        let resultDisplayed = false;

        // Function to reset the display if a result was just shown
        function checkResult() {
            if (resultDisplayed) {
                currentInput = '';
                resultDisplayed = false;
            }
        }

        function updateDisplay() {
            display.value = currentInput || '0';
        }

        // Handle number clicks
        function appendNumber(number) {
            checkResult();
            currentInput += number;
            updateDisplay();
        }

        // Handle operator clicks
        function appendOperator(operator) {
            resultDisplayed = false; 
            if (currentInput === '' && (operator === '+' || operator === '*' || operator === '/')) return;
            
            const lastChar = currentInput.slice(-1);
            if (['+', '-', '*', '/'].includes(lastChar)) {
                if (operator !== '-') {
                    currentInput = currentInput.slice(0, -1) + operator;
                }
            } else {
                currentInput += operator;
            }
            updateDisplay();
        }

        // Handle decimal point
        function appendDecimal() {
            checkResult();
            const parts = currentInput.split(/[+\-*/]/);
            const lastPart = parts[parts.length - 1];

            if (lastPart.includes('.')) return;
            
            if (currentInput === '' || ['+', '-', '*', '/'].includes(currentInput.slice(-1))) {
                currentInput += '0.';
            } else {
                currentInput += '.';
            }
            updateDisplay();
        }

        // Clear display
        function clearDisplay() {
            currentInput = '';
            resultDisplayed = false;
            updateDisplay();
        }

        /**
         * Flashes an element by rapidly toggling its 'hidden' class.
         * @param {HTMLElement} element - The element to flash.
         * @param {number} flashes - The number of times to show/hide the element (e.g., 6).
         * @param {number} speed - The duration in milliseconds for each state (show or hide).
         */
        function flashGif(element, flashes = 6, speed = 150) {
            let count = 0;
            
            function toggleFlash() {
                if (count < flashes * 2) {
                    // Show on even counts, Hide on odd counts
                    if (count % 2 === 0) {
                        element.classList.remove('hidden'); // Show
                    } else {
                        element.classList.add('hidden'); // Hide
                    }
                    count++;
                    setTimeout(toggleFlash, speed);
                } else {
                    element.classList.add('hidden'); // Ensure final state is hidden
                }
            }
            
            toggleFlash();
        }

        // The central logic: The result is ALWAYS 67
        function calculate() {
            // Play the actual MP3 sound
            playBoomSound(); 
            
            const sahurGifContainer = document.getElementById('sahur-gif-container');

            if (currentInput === '') {
                display.value = '67';
            } else {
                display.value = '67';
                currentInput = '67'; 
                resultDisplayed = true;
            }
            
            // Trigger the flashing effect
            flashGif(sahurGifContainer, 6, 150); 
        }

        // Simple keyboard support
        document.addEventListener('keydown', (event) => {
            const key = event.key;
            if (/[0-9]/.test(key)) {
                appendNumber(key);
            } else if (['+', '-', '*', '/'].includes(key)) {
                appendOperator(key);
            } else if (key === '.') {
                appendDecimal();
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault(); 
                calculate();
            } else if (key === 'Escape' || key === 'Delete') {
                clearDisplay();
            }
            // Trigger audio start on key press too
            startAudioContextAndLoop();
        });

        // Initialize display to 0
        updateDisplay();
    </script>
</body>
</html>
